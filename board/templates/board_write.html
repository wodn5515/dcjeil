{% extends "base.html" %}
{% load static %}
{% block title %}
글쓰기 | {{title}} | 덕천제일교회
{% endblock title %}
{% block content %}
{% include "board_title.html" %}
<div id="wrapper" class="after" v-bind:class="{mob_menu_on:menu_token}">
    <div id="content" class="write">
        <div id="write_wrap">
            <h2>글쓰기</h2>
            <form id="post_write" autocomplete='off' method="POST" enctype="multipart/form-data">
            {{forms.media}}
            {% csrf_token %}
            {% for field in forms %}
            <div class="field_wrap{% if field.label == '내용' %} content{% endif %}{% if field.errors %} error_label{% endif %}">
                {% if not field.is_hidden %}
                {{ field.label_tag }}
                {% endif %}
                {% if field.errors %}<span class="error">{{ field.errors.0 }}</span>{% endif %}
                {% if field.help_text %}
                <div class="help_text">{{ field.help_text }}</div>
                {% endif %}
                <div class="input_wrap">
                    {{ field }}
                </div>
            </div>
            {% endfor %}
            <div id="fileform_wrap">
                {{ fileforms.management_form }}
                {% for field in fileforms %}
                <div class="field_wrap">
                    {% if forloop.counter == 1 %}
                    {{ field.file.label_tag }}
                    {% endif %}
                    <div class="input_wrap">
                        <span class="filecount">#{{forloop.counter}}</span>
                        {{ field.file }}
                    </div>
                    {{ field.id }}
                </div>
                {% endfor %}
            </div><input id="file_add" type="button" value="추가">
            <div id="button_wrap">
                <input type="submit" value="등록">
            </div>
            </form>
        </div>
    </div>
</div>
{% endblock content %}
{% block js %}
{{ block.super }}
<script type="text/javascript">
$("#file_add").click(function(e){
    total = $('input[name=form-TOTAL_FORMS]').val()
    delete_icon = "{% static 'img/cmt_delete.png' %}"
    if(total == 5){
        alert('첨부파일은 최대 5개입니다.')
        return false;
        }
    newElement = '<div class="field_wrap"><div class="input_wrap">\
                <span class="filecount">#'+(parseInt(total)+1)+'</span>\
                <input type="file" name="form-'+ total +'-file" id="id_form-'+ total +'-file"></div>\
                <input type="hidden" name="form-'+ total +'-id" id="id_form-'+ total +'-id">\
                <img class="file_delete" src=' + delete_icon + '></div>'
    total++;
    $('input[name=form-TOTAL_FORMS]').val(total);
    $('#fileform_wrap').append(newElement)
});

$("#fileform_wrap").on('click', '.file_delete', function(e){
    total = $('input[name=form-TOTAL_FORMS]').val();
    $(e.currentTarget).closest('.field_wrap').remove();
    total--;
    $('input[name=form-TOTAL_FORMS]').val(total);
})
</script>
{% endblock js %}